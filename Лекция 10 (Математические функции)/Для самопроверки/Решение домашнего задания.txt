/*
Напишите запрос, который в разрезе периода (yyyymm) вернет:
сумму налогов и доставки (TaxAmt + Freight) с округлением (по арифм. правилам) до 2 знаков после запятой, 
сумму налогов и доставки (TaxAmt + Freight) с усечением до 2 знаков после запятой,
разницу между суммами с округлением (по арифм. правилам) и усечением,
сумму налогов и доставки (TaxAmt + Freight) с округлением в верх,
разницу сумм между суммами с округлением (по арифм. правилам) и округлением в верх,
сумму налогов и доставки (TaxAmt + Freight) с округлением в низ,
разницу сумм между суммами с округлением (по арифм. правилам) и округлением в низ.
Учитывайте только закупки, которые были проведены начиная с 2012 г.
Не учитывайте закупки со статусами ([Status]) 2 и 3. 
Не учитывайте закупки, которые были доставлены по методу (ShipMethodID) 1.
- Используется таблица [Purchasing].[PurchaseOrderHeader]
- Задействуйте функцию для работы с датой: format
- Задействуйте математические функции: round, ceiling, floor
- Отсортируйте рез. набор данных по периоду (по возрастанию)

*/

select format(t1.OrderDate, 'yyyyMM', 'en-US')                                                 as [period],  -- период
	   round(sum(t1.TaxAmt + t1.Freight), 2, 0)                                            as [round0],  -- сумма налогов и доставки (TaxAmt + Freight) с округлением (по арифм. правилам) до 2 знаков после запятой
	   round(sum(t1.TaxAmt + t1.Freight), 2, 1)                                            as [round1],  -- сумма налогов и доставки (TaxAmt + Freight) с усечением до 2 знаков после запятой
	   round(sum(t1.TaxAmt + t1.Freight), 2, 0) - round(sum(t1.TaxAmt + t1.Freight), 2, 1) as [diff1],   -- разница между суммами с округлением (по арифм. правилам) и усечением
	   ceiling(sum(t1.TaxAmt + t1.Freight))                                                as [ceiling], -- сумма налогов и доставки (TaxAmt + Freight) с округлением в верх
	   round(sum(t1.TaxAmt + t1.Freight), 2, 0) - ceiling(sum(t1.TaxAmt + t1.Freight))     as [diff2],   -- разница сумм между суммами с округлением (по арифм. правилам) и округлением в верх
	   floor(sum(t1.TaxAmt + t1.Freight))                                                  as [floors],  -- сумма налогов и доставки (TaxAmt + Freight) с округлением в низ
	   round(sum(t1.TaxAmt + t1.Freight), 2, 0) - floor(sum(t1.TaxAmt + t1.Freight))       as [diff3]    -- разница сумм между суммами с округлением (по арифм. правилам) и округлением в низ
  from [Purchasing].[PurchaseOrderHeader] as t1
 where t1.[Status] not in (2, 3) -- Не учитывайте закупки со статусами ([Status]) 2 и 3
   and t1.ShipMethodID != 1      -- Не учитывайте закупки, которые были доставлены по методу (ShipMethodID) 1
   and year(OrderDate) >= 2012   -- Учитывайте только закупки, которые были проведены начиная с 2012 г
 group by format(t1.OrderDate, 'yyyyMM', 'en-US')
 order by [period] asc;          -- - Отсортируйте рез. набор данных по периоду (по возрастанию)
          